# üé® –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫

## üìã –ö–û–ù–¢–ï–ö–°–¢

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¢–æ—á–∫–∞ –ë–∞–Ω–∫ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏.

---

## üéØ –ë–ò–ó–ù–ï–°-–¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–¥–ø–∏—Å–∫–∏:

1. **–¢—Ä–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥:** 14 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
2. **–¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã:**
   - 1 –º–µ—Å—è—Ü - 990‚ÇΩ (990‚ÇΩ/–º–µ—Å)
   - 3 –º–µ—Å—è—Ü–∞ - 2490‚ÇΩ (830‚ÇΩ/–º–µ—Å, –≤—ã–≥–æ–¥–∞ 16%)
   - 6 –º–µ—Å—è—Ü–µ–≤ - 4490‚ÇΩ (748‚ÇΩ/–º–µ—Å, –≤—ã–≥–æ–¥–∞ 24%)
   - 12 –º–µ—Å—è—Ü–µ–≤ - 7990‚ÇΩ (666‚ÇΩ/–º–µ—Å, –≤—ã–≥–æ–¥–∞ 33%)

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:**
   - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–≤–æ–µ–π –ø–æ–¥–ø–∏—Å–∫–∏
   - –ü–æ–∫—É–ø–∞—Ç—å/–ø—Ä–æ–¥–ª–µ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
   - –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π
   - –í—ã–±–∏—Ä–∞—Ç—å —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã (–∫–∞—Ä—Ç–∞ –∏–ª–∏ –°–ë–ü)

4. **–ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã:**
   - –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ –±—Ä–∞—É–∑–µ—Ä
   - –û–ø–ª–∞—Ç–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –¢–æ—á–∫–∏ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI

---

## üì° API ENDPOINTS (BACKEND)

### 1. GET /api/subscriptions/plans
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –ù–ï–¢

**Request:** –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**Response 200:**
```typescript
Array<{
  uuid: string;              // "59547ece-6264-45aa-b584-2552fe1700e1"
  plan_type: string;         // "month_1" | "month_3" | "month_6" | "month_12"
  name: string;              // "1 –º–µ—Å—è—Ü"
  duration_months: number;   // 1
  price: number;             // 990.00
  price_per_month: number;   // 990.00
  description: string | null;// "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 1 –º–µ—Å—è—Ü"
  is_active: boolean;        // true
}>
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
[
  {
    "uuid": "59547ece-6264-45aa-b584-2552fe1700e1",
    "plan_type": "month_1",
    "name": "1 –º–µ—Å—è—Ü",
    "duration_months": 1,
    "price": 990.00,
    "price_per_month": 990.00,
    "description": "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 1 –º–µ—Å—è—Ü",
    "is_active": true
  },
  {
    "uuid": "388150b5-ff0b-4143-bb20-d6f93694627d",
    "plan_type": "month_3",
    "name": "3 –º–µ—Å—è—Ü–∞",
    "duration_months": 3,
    "price": 2490.00,
    "price_per_month": 830.00,
    "description": "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 3 –º–µ—Å—è—Ü–∞. –í—ã–≥–æ–¥–∞ 16%!",
    "is_active": true
  }
]
```

---

### 2. GET /api/subscriptions/status
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–ê (Bearer token)

**Request:** –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**Response 200:**
```typescript
{
  subscription_status: "pending" | "active" | "expired";
  subscription_until: string | null;  // "2025-11-07" (–¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD)
  is_trial: boolean;                  // true –µ—Å–ª–∏ —Ç—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
  trial_used: boolean;                // true –µ—Å–ª–∏ —Ç—Ä–∏–∞–ª —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
  days_remaining: number | null;      // 14 (–¥–Ω–µ–π –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è)
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "subscription_status": "active",
  "subscription_until": "2025-10-22",
  "is_trial": true,
  "trial_used": true,
  "days_remaining": 14
}
```

---

### 3. POST /api/subscriptions/activate-trial
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤—Ä—É—á–Ω—É—é (–æ–±—ã—á–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–ê

**Request:** –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**Response 200:**
```typescript
{
  message: string;           // "–¢—Ä–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!"
  subscription_uuid: string; // UUID –ø–æ–¥–ø–∏—Å–∫–∏
  expires_at: string;        // "2025-10-22T12:00:00" (ISO datetime)
  is_trial: boolean;         // true
}
```

**Response 400:** –¢—Ä–∏–∞–ª —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
```json
{
  "detail": "–¢—Ä–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω"
}
```

---

### 4. POST /api/subscriptions/purchase
**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–ê

**Request Body:**
```typescript
{
  plan_uuid: string;           // UUID —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ (–∏–∑ /plans)
  return_url?: string;         // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, URL –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é deep link)
  payment_mode?: string[];     // ["card", "sbp"] –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –í–æ–∑–º–æ–∂–Ω–æ: "card", "sbp", "tinkoff", "dolyame"
}
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "plan_uuid": "59547ece-6264-45aa-b584-2552fe1700e1",
  "return_url": "myapp://payment/callback",
  "payment_mode": ["card", "sbp"]
}
```

**Response 200:**
```typescript
{
  payment_uuid: string;      // "ed07d0cc-91e2-4a0b-97f2-c41bcb5c4227"
  payment_url: string;       // "https://merch.tochka.com/order/?uuid=..."
  payment_link_id: string;   // "11"
  operation_id: string;      // "0c9639fc-5762-41c3-aa48-f5bf60bee75b"
}
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –æ—Ç–≤–µ—Ç–æ–º:**
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `payment_uuid` –ª–æ–∫–∞–ª—å–Ω–æ
2. –û—Ç–∫—Ä—ã—Ç—å `payment_url` –≤ –±—Ä–∞—É–∑–µ—Ä–µ/WebView
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç
4. –¢–æ—á–∫–∞ –¥–µ–ª–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `return_url`
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ `/payment/{payment_uuid}/status`

---

### 5. GET /api/subscriptions/payment/{payment_uuid}/status
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–ê

**Path –ø–∞—Ä–∞–º–µ—Ç—Ä:** `payment_uuid` - UUID –ø–ª–∞—Ç–µ–∂–∞ –∏–∑ –æ—Ç–≤–µ—Ç–∞ `/purchase`

**Response 200:**
```typescript
{
  status: "pending" | "processing" | "succeeded" | "failed" | "cancelled";
  amount: number;            // 990.00
  created_at: string;        // "2025-10-08T12:00:00" (ISO datetime)
  paid_at: string | null;    // "2025-10-08T12:05:00" –∏–ª–∏ null
  receipt_url: string | null;// "https://..." URL —á–µ–∫–∞
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ):**
```json
{
  "status": "processing",
  "amount": 990.00,
  "created_at": "2025-10-08T12:00:00",
  "paid_at": null,
  "receipt_url": null
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (—É—Å–ø–µ—à–Ω–æ):**
```json
{
  "status": "succeeded",
  "amount": 990.00,
  "created_at": "2025-10-08T12:00:00",
  "paid_at": "2025-10-08T12:05:00",
  "receipt_url": "https://check.tochka.com/..."
}
```

---

### 6. GET /api/subscriptions/history
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–ê

**Request:** –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**Response 200:**
```typescript
{
  payments: Array<{
    uuid: string;           // UUID –ø–ª–∞—Ç–µ–∂–∞
    amount: number;         // 990.00
    status: string;         // "succeeded" | "failed" | "cancelled"
    plan_name: string;      // "1 –º–µ—Å—è—Ü"
    created_at: string;     // ISO datetime
    paid_at: string | null; // ISO datetime
    receipt_url: string | null;
  }>
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "payments": [
    {
      "uuid": "ed07d0cc-91e2-4a0b-97f2-c41bcb5c4227",
      "amount": 990.00,
      "status": "succeeded",
      "plan_name": "1 –º–µ—Å—è—Ü",
      "created_at": "2025-10-08T12:00:00",
      "paid_at": "2025-10-08T12:05:00",
      "receipt_url": "https://check.tochka.com/..."
    },
    {
      "uuid": "...",
      "amount": 2490.00,
      "status": "succeeded",
      "plan_name": "3 –º–µ—Å—è—Ü–∞",
      "created_at": "2025-09-01T15:30:00",
      "paid_at": "2025-09-01T15:32:00",
      "receipt_url": "https://..."
    }
  ]
}
```

---

## üé® –¢–†–ï–ë–£–ï–ú–´–ï –≠–ö–†–ê–ù–´/–ö–û–ú–ü–û–ù–ï–ù–¢–´

### –≠–∫—Ä–∞–Ω 1: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

1. **–ë–ª–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏** (–≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –ø—Ä–æ—Ñ–∏–ª—è):

```tsx
<SubscriptionStatusCard>
  {/* –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ */}
  {status === 'active' && (
    <>
      <StatusBadge color="green">–ê–∫—Ç–∏–≤–Ω–∞</StatusBadge>
      {isTrial && <TrialBadge>–¢—Ä–∏–∞–ª—å–Ω–∞—è</TrialBadge>}
      <Text>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: {formatDate(subscription_until)}</Text>
      <Text>–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π: {days_remaining}</Text>
      <Button onPress={() => navigate('SubscriptionPlans')}>
        –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
      </Button>
    </>
  )}
  
  {/* –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ */}
  {status === 'expired' && (
    <>
      <StatusBadge color="red">–ò—Å—Ç–µ–∫–ª–∞</StatusBadge>
      <Text>–ü–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å {formatDate(subscription_until)}</Text>
      <Button primary onPress={() => navigate('SubscriptionPlans')}>
        –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
      </Button>
    </>
  )}
  
  {/* –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ */}
  {status === 'pending' && (
    <>
      <StatusBadge color="gray">–ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏</StatusBadge>
      {!trial_used && (
        <Button onPress={activateTrial}>
          –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏–∞–ª (14 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
        </Button>
      )}
      <Button primary onPress={() => navigate('SubscriptionPlans')}>
        –ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
      </Button>
    </>
  )}
</SubscriptionStatusCard>
```

**API –≤—ã–∑–æ–≤—ã:**
```typescript
// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
const status = await api.get('/api/subscriptions/status');
```

---

### –≠–∫—Ä–∞–Ω 2: –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ (–Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω)

**–†–æ—É—Ç:** `SubscriptionPlans` –∏–ª–∏ `/subscription/plans`

**–ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å:**

```tsx
<SubscriptionPlansScreen>
  <Header>
    <BackButton />
    <Title>–í—ã–±–æ—Ä –ø–æ–¥–ø–∏—Å–∫–∏</Title>
  </Header>
  
  <CurrentStatus>
    {/* –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–¥–ø–∏—Å–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å */}
    {hasActiveSubscription && (
      <InfoCard>
        –¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –¥–æ: {subscription_until}
        –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –Ω–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ —Å—Ä–æ–∫ –ø—Ä–æ–¥–ª–∏—Ç—Å—è –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–∞
      </InfoCard>
    )}
  </CurrentStatus>
  
  <PlansList>
    {plans.map(plan => (
      <PlanCard key={plan.uuid}>
        <PlanHeader>
          <PlanName>{plan.name}</PlanName>
          {plan.duration_months > 1 && (
            <DiscountBadge>
              –í—ã–≥–æ–¥–∞ {calculateDiscount(plan)}%
            </DiscountBadge>
          )}
        </PlanHeader>
        
        <PriceBlock>
          <MainPrice>{formatPrice(plan.price)}</MainPrice>
          <PricePerMonth>
            {formatPrice(plan.price_per_month)}/–º–µ—Å—è—Ü
          </PricePerMonth>
        </PriceBlock>
        
        <Description>{plan.description}</Description>
        
        <Features>
          <Feature>‚úì –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º</Feature>
          <Feature>‚úì –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</Feature>
          <Feature>‚úì –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</Feature>
          <Feature>‚úì –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –Ω–∞–≥—Ä–∞–¥—ã</Feature>
        </Features>
        
        <BuyButton 
          onPress={() => handlePurchase(plan)}
          primary={plan.duration_months === 3} // –í—ã–¥–µ–ª–∏—Ç—å –≤—ã–≥–æ–¥–Ω—ã–π
        >
          –ö—É–ø–∏—Ç—å –∑–∞ {formatPrice(plan.price)}
        </BuyButton>
      </PlanCard>
    ))}
  </PlansList>
</SubscriptionPlansScreen>
```

**API –≤—ã–∑–æ–≤—ã:**
```typescript
// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞
const plans = await api.get('/api/subscriptions/plans');

// –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Å–∫–∏–¥–∫–∏
function calculateDiscount(plan) {
  const basePricePerMonth = 990; // –¶–µ–Ω–∞ 1 –º–µ—Å—è—Ü–∞
  const discount = ((basePricePerMonth - plan.price_per_month) / basePricePerMonth) * 100;
  return Math.round(discount);
}
```

---

### –≠–∫—Ä–∞–Ω 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ (–ª–æ–≥–∏–∫–∞, –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω)

**Flow:**

```typescript
async function handlePurchase(plan) {
  try {
    // 1. –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∞–¥–µ—Ä
    setLoading(true);
    
    // 2. –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂–Ω—É—é —Å—Å—ã–ª–∫—É
    const response = await api.post('/api/subscriptions/purchase', {
      plan_uuid: plan.uuid,
      // return_url –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω, –±—ç–∫ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç deep link –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
      payment_mode: ["card", "sbp"] // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    });
    
    const { payment_url, payment_uuid } = response.data;
    
    // 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å payment_uuid –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
    await AsyncStorage.setItem('current_payment_uuid', payment_uuid);
    await AsyncStorage.setItem('payment_plan_name', plan.name);
    
    // 4. –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –æ–ø–ª–∞—Ç—ã
    await Linking.openURL(payment_url);
    
    setLoading(false);
    
  } catch (error) {
    setLoading(false);
    showError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞: ' + error.message);
  }
}
```

---

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ Deep Link –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

**Deep Link —Å—Ö–µ–º–∞:** `myapp://payment/callback`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Deep Links:**

**Android (AndroidManifest.xml):**
```xml
<intent-filter>
  <action android:name="android.intent.action.VIEW" />
  <category android:name="android.intent.category.DEFAULT" />
  <category android:name="android.intent.category.BROWSABLE" />
  <data android:scheme="myapp" android:host="payment" />
</intent-filter>
```

**iOS (Info.plist):**
```xml
<key>CFBundleURLTypes</key>
<array>
  <dict>
    <key>CFBundleURLSchemes</key>
    <array>
      <string>myapp</string>
    </array>
  </dict>
</array>
```

**React Native –∫–æ–¥:**

```typescript
import { Linking } from 'react-native';
import { useEffect } from 'react';
import { useNavigation } from '@react-navigation/native';

export function usePaymentDeepLink() {
  const navigation = useNavigation();
  
  useEffect(() => {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ initial URL (–µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã–ª–æ –∑–∞–∫—Ä—ã—Ç–æ)
    Linking.getInitialURL().then(url => {
      if (url) handleDeepLink(url);
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ URL –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ
    const subscription = Linking.addEventListener('url', ({ url }) => {
      handleDeepLink(url);
    });
    
    return () => subscription.remove();
  }, []);
  
  async function handleDeepLink(url: string) {
    console.log('Deep link received:', url);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ —Å—Å—ã–ª–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ –æ–ø–ª–∞—Ç—ã
    if (url.startsWith('myapp://payment/callback')) {
      // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π payment_uuid
      const payment_uuid = await AsyncStorage.getItem('current_payment_uuid');
      
      if (!payment_uuid) {
        console.warn('payment_uuid –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }
      
      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
      navigation.navigate('PaymentCheck', { payment_uuid });
    }
  }
}
```

---

### –≠–∫—Ä–∞–Ω 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ (–Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω)

**–†–æ—É—Ç:** `PaymentCheck` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `payment_uuid`

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

```tsx
<PaymentCheckScreen>
  <Loader text="–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã..." />
  
  {/* –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã */}
  {status === 'succeeded' && (
    <SuccessAnimation>
      <Icon name="check-circle" size={80} color="green" />
      <Title>–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞!</Title>
      <Text>–ü–æ–¥–ø–∏—Å–∫–∞ "{plan_name}" –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</Text>
      <Text>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: {subscription_until}</Text>
      
      {receipt_url && (
        <Button onPress={() => Linking.openURL(receipt_url)}>
          –°–∫–∞—á–∞—Ç—å —á–µ–∫
        </Button>
      )}
      
      <Button primary onPress={() => navigation.navigate('Profile')}>
        –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
      </Button>
    </SuccessAnimation>
  )}
  
  {/* –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–ø–ª–∞—Ç—ã */}
  {status === 'failed' && (
    <ErrorView>
      <Icon name="x-circle" size={80} color="red" />
      <Title>–û–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞</Title>
      <Text>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</Text>
      
      <Button onPress={() => navigation.navigate('SubscriptionPlans')}>
        –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ç–∞—Ä–∏—Ñ
      </Button>
    </ErrorView>
  )}
</PaymentCheckScreen>
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```typescript
function PaymentCheckScreen({ route }) {
  const { payment_uuid } = route.params;
  const [status, setStatus] = useState('checking');
  const [paymentInfo, setPaymentInfo] = useState(null);
  
  useEffect(() => {
    checkPaymentStatus();
  }, []);
  
  async function checkPaymentStatus() {
    const maxAttempts = 15; // –ú–∞–∫—Å–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥ (15 * 2 —Å–µ–∫)
    let attempts = 0;
    
    const check = async () => {
      try {
        const response = await api.get(
          `/api/subscriptions/payment/${payment_uuid}/status`
        );
        
        console.log('Payment status:', response.data.status);
        
        if (response.data.status === 'succeeded') {
          // ‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞
          setStatus('succeeded');
          setPaymentInfo(response.data);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          await refreshUserData();
          
          // –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
          await AsyncStorage.removeItem('current_payment_uuid');
          
        } else if (response.data.status === 'processing' || response.data.status === 'pending') {
          // ‚è≥ –ï—â–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
          attempts++;
          
          if (attempts < maxAttempts) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(check, 2000);
          } else {
            // –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫
            setStatus('timeout');
            showInfo('–û–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –ø–æ–∑–∂–µ.');
          }
          
        } else {
          // ‚ùå failed, cancelled
          setStatus('failed');
          setPaymentInfo(response.data);
        }
        
      } catch (error) {
        console.error('Error checking payment:', error);
        setStatus('error');
        showError('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞');
      }
    };
    
    // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    check();
  }
  
  return (/* UI –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ */);
}
```

---

### –≠–∫—Ä–∞–Ω 6: –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

**–†–æ—É—Ç:** `PaymentHistory` –∏–ª–∏ `/subscription/history`

```tsx
<PaymentHistoryScreen>
  <Header>
    <BackButton />
    <Title>–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π</Title>
  </Header>
  
  <PaymentsList>
    {payments.length === 0 && (
      <EmptyState>
        <Icon name="receipt" size={60} />
        <Text>–ü–ª–∞—Ç–µ–∂–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</Text>
      </EmptyState>
    )}
    
    {payments.map(payment => (
      <PaymentCard key={payment.uuid}>
        <PaymentHeader>
          <PlanName>{payment.plan_name}</PlanName>
          <StatusBadge status={payment.status}>
            {getStatusText(payment.status)}
          </StatusBadge>
        </PaymentHeader>
        
        <PaymentDetails>
          <DetailRow>
            <Label>–°—É–º–º–∞:</Label>
            <Value>{formatPrice(payment.amount)}</Value>
          </DetailRow>
          
          <DetailRow>
            <Label>–î–∞—Ç–∞:</Label>
            <Value>{formatDate(payment.created_at)}</Value>
          </DetailRow>
          
          {payment.paid_at && (
            <DetailRow>
              <Label>–û–ø–ª–∞—á–µ–Ω–æ:</Label>
              <Value>{formatDateTime(payment.paid_at)}</Value>
            </DetailRow>
          )}
        </PaymentDetails>
        
        {payment.receipt_url && payment.status === 'succeeded' && (
          <DownloadReceiptButton 
            onPress={() => Linking.openURL(payment.receipt_url)}
          >
            –°–∫–∞—á–∞—Ç—å —á–µ–∫
          </DownloadReceiptButton>
        )}
      </PaymentCard>
    ))}
  </PaymentsList>
</PaymentHistoryScreen>
```

**API –≤—ã–∑–æ–≤:**
```typescript
const response = await api.get('/api/subscriptions/history');
const { payments } = response.data;
```

**–§—É–Ω–∫—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```typescript
function getStatusText(status: string): string {
  const statusMap = {
    'succeeded': '–û–ø–ª–∞—á–µ–Ω',
    'failed': '–û—à–∏–±–∫–∞',
    'cancelled': '–û—Ç–º–µ–Ω–µ–Ω',
    'processing': '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
    'pending': '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã'
  };
  return statusMap[status] || status;
}

function formatPrice(amount: number): string {
  return new Intl.NumberFormat('ru-RU', {
    style: 'currency',
    currency: 'RUB',
    minimumFractionDigits: 0
  }).format(amount);
}

function formatDate(dateString: string): string {
  return new Date(dateString).toLocaleDateString('ru-RU');
}

function formatDateTime(dateString: string): string {
  return new Date(dateString).toLocaleString('ru-RU');
}
```

---

## üîÑ –ü–û–õ–ù–´–ô FLOW –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ç—Ä–∏–∞–ª)

```
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   ‚Üì (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
2. –¢—Ä–∏–∞–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω (14 –¥–Ω–µ–π)
   ‚Üì
3. –ü—Ä–æ—Ñ–∏–ª—å ‚Üí –≤–∏–¥–∏—Ç "–¢—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞, –æ—Å—Ç–∞–ª–æ—Å—å 14 –¥–Ω–µ–π"
   ‚Üì (—á–µ—Ä–µ–∑ 14 –¥–Ω–µ–π, cron –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å)
4. –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ ‚Üí subscription_status = 'expired'
   ‚Üì
5. –ü—Ä–æ—Ñ–∏–ª—å ‚Üí –≤–∏–¥–∏—Ç "–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞" + –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–ª–∏—Ç—å"
   ‚Üì
6. –ù–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–æ–¥–ª–∏—Ç—å" ‚Üí –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞
   ‚Üì
7. –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–ª–∞—Ç—ë–∂–Ω–∞—è —Å—Å—ã–ª–∫–∞
   ‚Üì
8. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä ‚Üí –æ–ø–ª–∞—Ç–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –¢–æ—á–∫–∏
   ‚Üì
9. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç myapp://payment/callback
   ‚Üì
10. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç deep link ‚Üí —ç–∫—Ä–∞–Ω –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
   ‚Üì
11. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫ ‚Üí status = 'succeeded'
   ‚Üì
12. –ü–æ–∫–∞–∑–∞—Ç—å "–£—Å–ø–µ—à–Ω–æ!" ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚Üì
13. –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –≤–∏–¥–∏—Ç "–ê–∫—Ç–∏–≤–Ω–∞ –¥–æ ..."
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏

```
1. –ü—Ä–æ—Ñ–∏–ª—å ‚Üí "–ê–∫—Ç–∏–≤–Ω–∞ –¥–æ 08.11.2025, –æ—Å—Ç–∞–ª–æ—Å—å 30 –¥–Ω–µ–π"
   ‚Üì
2. –ù–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–æ–¥–ª–∏—Ç—å" ‚Üí –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞
   ‚Üì
3. –í—ã–±–∏—Ä–∞–µ—Ç "3 –º–µ—Å—è—Ü–∞" ‚Üí –æ–ø–ª–∞—Ç–∞
   ‚Üì
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
   - –°—Ç–∞—Ä–∞—è –¥–∞—Ç–∞: 08.11.2025
   - –ù–æ–≤–∞—è –¥–∞—Ç–∞: 08.02.2026 (—Å—Ç–∞—Ä–∞—è + 90 –¥–Ω–µ–π)
   - –ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∞ –ë–ï–ó –†–ê–ó–†–´–í–ê
```

---

## üì± –î–ò–ó–ê–ô–ù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤:

```typescript
const statusColors = {
  active: '#22C55E',    // –ó–µ–ª–µ–Ω—ã–π
  expired: '#EF4444',   // –ö—Ä–∞—Å–Ω—ã–π
  pending: '#94A3B8',   // –°–µ—Ä—ã–π
  trial: '#3B82F6'      // –°–∏–Ω–∏–π (–¥–ª—è —Ç—Ä–∏–∞–ª–∞)
};
```

### –ê–∫—Ü–µ–Ω—Ç—ã:

1. **–°–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π —Ç–∞—Ä–∏—Ñ** (3 –∏–ª–∏ 6 –º–µ—Å—è—Ü–µ–≤):
   - –ë–µ–π–¥–∂ "–ü–æ–ø—É–ª—è—Ä–Ω—ã–π" –∏–ª–∏ "–í—ã–≥–æ–¥–Ω–æ"
   - –Ø—Ä–∫–∞—è —Ä–∞–º–∫–∞
   - –ü–µ—Ä–≤–∏—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞

2. **–¢—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞:**
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –±–µ–π–¥–∂ "–¢—Ä–∏–∞–ª"
   - –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –¥–Ω–µ–π

3. **–ò—Å—Ç–µ–∫—à–∞—è –ø–æ–¥–ø–∏—Å–∫–∞:**
   - –ö—Ä–∞—Å–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
   - –ö—Ä—É–ø–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–ª–∏—Ç—å"

---

## üõ†Ô∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### State Management

–†–µ–∫–æ–º–µ–Ω–¥—É—é —Ö—Ä–∞–Ω–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ:

```typescript
// Zustand –∏–ª–∏ Redux
interface SubscriptionState {
  status: 'pending' | 'active' | 'expired';
  subscription_until: string | null;
  is_trial: boolean;
  trial_used: boolean;
  days_remaining: number | null;
  plans: Plan[];
}

// Actions
async function fetchSubscriptionStatus() {
  const data = await api.get('/api/subscriptions/status');
  setSubscriptionState(data);
}

async function fetchPlans() {
  const plans = await api.get('/api/subscriptions/plans');
  setPlans(plans);
}
```

---

### API Client

```typescript
// api/subscriptions.ts

export const subscriptionsAPI = {
  // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤
  getPlans: async () => {
    const response = await apiClient.get('/api/subscriptions/plans');
    return response.data;
  },
  
  // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
  getStatus: async () => {
    const response = await apiClient.get('/api/subscriptions/status');
    return response.data;
  },
  
  // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏–∞–ª
  activateTrial: async () => {
    const response = await apiClient.post('/api/subscriptions/activate-trial');
    return response.data;
  },
  
  // –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂–Ω—É—é —Å—Å—ã–ª–∫—É
  createPayment: async (planUuid: string, paymentMode?: string[]) => {
    const response = await apiClient.post('/api/subscriptions/purchase', {
      plan_uuid: planUuid,
      payment_mode: paymentMode
    });
    return response.data;
  },
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
  checkPaymentStatus: async (paymentUuid: string) => {
    const response = await apiClient.get(
      `/api/subscriptions/payment/${paymentUuid}/status`
    );
    return response.data;
  },
  
  // –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–ª–∞—Ç–µ–∂–µ–π
  getHistory: async () => {
    const response = await apiClient.get('/api/subscriptions/history');
    return response.data;
  }
};
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´

### 1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

```typescript
try {
  await subscriptionsAPI.createPayment(plan.uuid);
} catch (error) {
  if (error.response?.status === 400) {
    // –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    showError(error.response.data.detail);
  } else if (error.response?.status === 401) {
    // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    navigation.navigate('Login');
  } else {
    // –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏
    showError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
  }
}
```

---

### 2. **Timeout –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞**

```typescript
// –ù–µ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ!
const MAX_ATTEMPTS = 15;  // 30 —Å–µ–∫—É–Ω–¥
const CHECK_INTERVAL = 2000; // 2 —Å–µ–∫—É–Ω–¥—ã

// –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç:
if (attempts >= MAX_ATTEMPTS) {
  showInfo('–û–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è. –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.');
  navigation.navigate('PaymentHistory');
}
```

---

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã**

```typescript
async function refreshUserData() {
  // –û–±–Ω–æ–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  await fetchUserProfile();
  await fetchSubscriptionStatus();
}
```

---

### 4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–∫–∏**

–ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç **5 –º–∏–Ω—É—Ç** (`ttl: 5`). –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–π–º–µ—Ä:

```typescript
<PaymentLinkNotice>
  ‚ö†Ô∏è –°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 5 –º–∏–Ω—É—Ç
</PaymentLinkNotice>
```

---

## üìä UI –ö–û–ú–ü–û–ù–ï–ù–¢–´

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ

```tsx
<SubscriptionBanner>
  {subscription_status === 'active' && days_remaining <= 3 && (
    <WarningBanner>
      ‚ö†Ô∏è –ü–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ {days_remaining} –¥–Ω–µ–π
      <Button size="small" onPress={() => navigate('SubscriptionPlans')}>
        –ü—Ä–æ–¥–ª–∏—Ç—å
      </Button>
    </WarningBanner>
  )}
  
  {subscription_status === 'expired' && (
    <ExpiredBanner>
      ‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞
      <Button primary onPress={() => navigate('SubscriptionPlans')}>
        –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
      </Button>
    </ExpiredBanner>
  )}
</SubscriptionBanner>
```

---

## üéØ –ú–ò–ù–ò–ú–ê–õ–¨–ù–û –ù–ï–û–ë–•–û–î–ò–ú–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

- [x] –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞ (—Å–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–æ–≤)
- [x] –ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏)
- [x] –û—Ç–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã
- [x] Deep Link –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

- [ ] –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- [ ] –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –ö—Ä–∞—Å–∏–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–∫–∏
- [ ] –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã (–∫–∞—Ä—Ç–∞/–°–ë–ü)

---

## üìù –¢–ò–ü–´ –î–ê–ù–ù–´–• (TypeScript)

```typescript
// types/subscription.ts

export interface SubscriptionPlan {
  uuid: string;
  plan_type: 'month_1' | 'month_3' | 'month_6' | 'month_12';
  name: string;
  duration_months: number;
  price: number;
  price_per_month: number;
  description: string | null;
  is_active: boolean;
}

export interface SubscriptionStatus {
  subscription_status: 'pending' | 'active' | 'expired';
  subscription_until: string | null;
  is_trial: boolean;
  trial_used: boolean;
  days_remaining: number | null;
}

export interface PaymentResponse {
  payment_uuid: string;
  payment_url: string;
  payment_link_id: string;
  operation_id: string;
}

export interface PaymentStatus {
  status: 'pending' | 'processing' | 'succeeded' | 'failed' | 'cancelled';
  amount: number;
  created_at: string;
  paid_at: string | null;
  receipt_url: string | null;
}

export interface PaymentHistoryItem {
  uuid: string;
  amount: number;
  status: string;
  plan_name: string;
  created_at: string;
  paid_at: string | null;
  receipt_url: string | null;
}
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è deep links (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å deep link —Å—Ö–µ–º—É `myapp://`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –≠–∫—Ä–∞–Ω—ã:
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —ç–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è (–¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏)
- [ ] –°–æ–∑–¥–∞—Ç—å —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å —ç–∫—Ä–∞–Ω –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
- [ ] –°–æ–∑–¥–∞—Ç—å —ç–∫—Ä–∞–Ω –∏—Å—Ç–æ—Ä–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –õ–æ–≥–∏–∫–∞:
- [ ] API –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤—Å–µ—Ö endpoints
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ deep links
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ —Å retry
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### UI/UX:
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–∞—Ä–∏—Ñ–∞
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –ê–Ω–∏–º–∞—Ü–∏–∏ —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–∫–∏
- [ ] –õ–æ–∞–¥–µ—Ä—ã –∏ —Å–∫–µ–ª–µ—Ç–æ–Ω—ã

---

## üöÄ –ù–ê–ß–ù–ò –° –≠–¢–û–ì–û

–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –≤ Cursor –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:

```
–ú–Ω–µ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (React Native / Flutter / —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è).

–ö–û–ù–¢–ï–ö–°–¢:
–ù–∞ –±—ç–∫–µ–Ω–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –¢–æ—á–∫–∞ –ë–∞–Ω–∫.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 14 –¥–Ω–µ–π —Ç—Ä–∏–∞–ª–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
–ï—Å—Ç—å 4 —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–∞: 1, 3, 6, 12 –º–µ—Å—è—Ü–µ–≤.

–ù–£–ñ–ù–û –†–ï–ê–õ–ò–ó–û–í–ê–¢–¨:

1. –≠–ö–†–ê–ù –í–´–ë–û–†–ê –¢–ê–†–ò–§–ê
- –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–æ–≤ –∏–∑ GET /api/subscriptions/plans
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å —Ü–µ–Ω–æ–π, –≤—ã–≥–æ–¥–æ–π, –æ–ø–∏—Å–∞–Ω–∏–µ–º
- –í—ã–¥–µ–ª–∏—Ç—å —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π —Ç–∞—Ä–∏—Ñ
- –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞–Ω–∞

2. –ü–†–û–¶–ï–°–° –û–ü–õ–ê–¢–´
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ "–ö—É–ø–∏—Ç—å" ‚Üí POST /api/subscriptions/purchase
- –ü–æ–ª—É—á–∏—Ç—å payment_url ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å payment_uuid –ª–æ–∫–∞–ª—å–Ω–æ

3. –û–ë–†–ê–ë–û–¢–ö–ê –í–û–ó–í–†–ê–¢–ê –ò–ó –û–ü–õ–ê–¢–´
- Deep link: myapp://payment/callback
- –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π payment_uuid
- –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

4. –≠–ö–†–ê–ù –ü–†–û–í–ï–†–ö–ò –ü–õ–ê–¢–ï–ñ–ê
- –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∞–¥–µ—Ä "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã..."
- –û–ø—Ä–∞—à–∏–≤–∞—Ç—å GET /api/subscriptions/payment/{uuid}/status –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫
- –ú–∞–∫—Å–∏–º—É–º 15 –ø–æ–ø—ã—Ç–æ–∫ (30 —Å–µ–∫—É–Ω–¥)
- –ü—Ä–∏ succeeded ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö, –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–∏ failed ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É

5. –û–ë–ù–û–í–ò–¢–¨ –≠–ö–†–ê–ù –ü–†–û–§–ò–õ–Ø
- –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ (GET /api/subscriptions/status)
- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏ –¥–Ω–µ–π –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–ª–∏—Ç—å" –∏–ª–∏ "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏–∞–ª"

6. (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û) –ò–°–¢–û–†–ò–Ø –ü–õ–ê–¢–ï–ñ–ï–ô
- GET /api/subscriptions/history
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π —Å —á–µ–∫–∞–º–∏

–î–ï–¢–ê–õ–ò –í –§–ê–ô–õ–ï: [–ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç]
```

---

–≠—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ Cursor! üéØ
