# ‚úÖ –†–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫

## üéâ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¢–æ—á–∫–∞ –ë–∞–Ω–∫ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ú–æ–¥–µ–ª–∏ –∏ DAO
- ‚úÖ `app/subscriptions/models.py` - –º–æ–¥–µ–ª–∏ SubscriptionPlan, Payment, Subscription
- ‚úÖ `app/subscriptions/dao.py` - DAO –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- ‚úÖ `app/users/models.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–æ (–¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è trial_used, trial_started_at, —Å–≤—è–∑–∏ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏)

### –°–µ—Ä–≤–∏—Å—ã
- ‚úÖ `app/payments/tochka_service.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API –¢–æ—á–∫–∞ –ë–∞–Ω–∫–∞
- ‚úÖ `app/subscriptions/service.py` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫

### API
- ‚úÖ `app/subscriptions/schemas.py` - Pydantic —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ `app/subscriptions/router.py` - API endpoints
- ‚úÖ `app/main.py` - —Ä–æ—É—Ç–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `app/config.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –¢–æ—á–∫–∏
- ‚úÖ `app/migration/env.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ `app/migration/versions/f5992c8e0d54_add_subscriptions_and_payments_tables.py` - –º–∏–≥—Ä–∞—Ü–∏—è –ë–î

### –£—Ç–∏–ª–∏—Ç—ã
- ‚úÖ `create_subscription_plans.py` - —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `app/subscriptions/README.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
- ‚úÖ `SUBSCRIPTION_SETUP_GUIDE.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- ‚úÖ `SUBSCRIPTION_IMPLEMENTATION_SUMMARY.md` - —ç—Ç–æ —Ä–µ–∑—é–º–µ

---

## üîß –î–æ—Ä–∞–±–æ—Ç–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### app/users/router.py
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç—Ä–∏–∞–ª–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –¢—Ä–∏–∞–ª –Ω–∞ 14 –¥–Ω–µ–π —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –¢—Ä–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- **14 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

### 2. –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã
- **1 –º–µ—Å—è—Ü** - 990‚ÇΩ (990‚ÇΩ/–º–µ—Å)
- **3 –º–µ—Å—è—Ü–∞** - 2490‚ÇΩ (830‚ÇΩ/–º–µ—Å, -16%)
- **6 –º–µ—Å—è—Ü–µ–≤** - 4490‚ÇΩ (748‚ÇΩ/–º–µ—Å, -24%)
- **12 –º–µ—Å—è—Ü–µ–≤** - 7990‚ÇΩ (666‚ÇΩ/–º–µ—Å, -33%)

### 3. –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–ª–∞—Ç—ë–∂–Ω–∞—è —Å—Å—ã–ª–∫–∞ –≤ –¢–æ—á–∫–µ
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ –¢–æ—á–∫—É (–∫–∞—Ä—Ç–∞/–°–ë–ü)
4. –¢–æ—á–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ–±—Ö—É–∫ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
5. –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### 4. –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¢–æ—á–∫–∞ –ë–∞–Ω–∫ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—ë–∂–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è —á–µ–∫–æ–≤ (54-–§–ó)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–ª–∞—Ç—ã –∫–∞—Ä—Ç–∞–º–∏ –∏ –°–ë–ü
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è PCI DSS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- ‚úÖ –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ–Ω–ª–∞–π–Ω-–∫–∞—Å—Å–∞

---

## üì° API Endpoints

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/subscriptions/plans` | –°–ø–∏—Å–æ–∫ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ |
| POST | `/api/subscriptions/activate-trial` | –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç—Ä–∏–∞–ª–∞ (—É–∂–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏) |
| POST | `/api/subscriptions/purchase` | –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏ |
| GET | `/api/subscriptions/status` | –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| GET | `/api/subscriptions/payment/{uuid}/status` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ |
| GET | `/api/subscriptions/history` | –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π |
| POST | `/api/subscriptions/webhook` | –í–µ–±—Ö—É–∫ –æ—Ç –¢–æ—á–∫–∏ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) |

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

**subscription_plans** (—Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã)
```sql
- id (PK)
- uuid (unique)
- plan_type (enum: month_1, month_3, month_6, month_12)
- name (varchar)
- duration_months (int)
- price (decimal)
- price_per_month (decimal)
- description (text)
- is_active (boolean)
- created_at, updated_at (timestamp)
```

**payments** (–∏—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π)
```sql
- id (PK)
- uuid (unique)
- user_id (FK ‚Üí user.id)
- plan_id (FK ‚Üí subscription_plans.id)
- amount (decimal)
- status (enum: pending, processing, succeeded, failed, cancelled, refunded)
- payment_id (varchar) -- ID –æ—Ç –¢–æ—á–∫–∏
- payment_url (text)
- receipt_url (text)
- error_message (text)
- payment_metadata (text)
- created_at, updated_at, paid_at (timestamp)
```

**subscriptions** (–ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
```sql
- id (PK)
- uuid (unique)
- user_id (FK ‚Üí user.id)
- plan_id (FK ‚Üí subscription_plans.id, nullable)
- payment_id (FK ‚Üí payments.id, nullable)
- started_at, expires_at (timestamp)
- is_trial (boolean)
- auto_renew (boolean)
- created_at, updated_at (timestamp)
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ user:
```sql
+ trial_used (boolean)
+ trial_started_at (timestamp)
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
# JWT-—Ç–æ–∫–µ–Ω –æ—Ç –¢–æ—á–∫–∏ (–í–°–¢–ê–í–¨–¢–ï –í–ê–® –¢–û–ö–ï–ù –°–Æ–î–ê)
TOCHKA_ACCESS_TOKEN=your_jwt_token_here

# URL API –¢–æ—á–∫–∏
TOCHKA_API_URL=https://api.tochka.com/v1

# –°—Ç–∞–≤–∫–∞ –ù–î–°
TOCHKA_VAT_CODE=vat20

# URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤)
BASE_URL=http://localhost:8000
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ó–∞–º–µ–Ω–∏—Ç–µ `your_jwt_token_here` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π JWT-—Ç–æ–∫–µ–Ω!

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# 1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\.venv\Scripts\Activate.ps1

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# 3. –°–æ–∑–¥–∞—Ç—å —Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã
python create_subscription_plans.py

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
uvicorn app.main:app --reload
```

---

## üì± –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ:

1. **–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø—Ä–æ—Ñ–∏–ª—è**
   ```typescript
   GET /api/subscriptions/status
   ```

2. **–≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Ç–∞—Ä–∏—Ñ–∞**
   ```typescript
   GET /api/subscriptions/plans
   ```

3. **–ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏**
   ```typescript
   POST /api/subscriptions/purchase
   ‚Üí –ü–æ–ª—É—á–∏—Ç—å payment_url
   ‚Üí –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   ```

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ –æ–ø–ª–∞—Ç—ã**
   ```typescript
   Deep Link: myapp://payment/callback
   ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
   ‚Üí –û–±–Ω–æ–≤–∏—Ç—å UI
   ```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (–ø–æ –∂–µ–ª–∞–Ω–∏—é):

- –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤
- –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ

---

## üîç –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –î–æ –∑–∞–ø—É—Å–∫–∞:
- [ ] JWT-—Ç–æ–∫–µ–Ω –æ—Ç –¢–æ—á–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.env`
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (`alembic upgrade head`)
- [ ] –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã —Å–æ–∑–¥–∞–Ω—ã (`python create_subscription_plans.py`)
- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
- [ ] Swagger –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `/docs`
- [ ] Endpoint `/api/subscriptions/plans` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 4 –ø–ª–∞–Ω–∞
- [ ] –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç—Ä–∏–∞–ª
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í–µ–±—Ö—É–∫–∏ –¥–æ—Ö–æ–¥—è—Ç –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

---

## üìã –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - POST `/auth/register/`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ç—Ä–∏–∞–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `subscription_status = active`, `subscription_until = +14 –¥–Ω–µ–π`

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**
   - GET `/api/subscriptions/status`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `is_trial = true`, `days_remaining = 14`

3. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–≤**
   - GET `/api/subscriptions/plans`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 4 –ø–ª–∞–Ω–∞

4. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞**
   - POST `/api/subscriptions/purchase` —Å `plan_id = 1`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `payment_url`
   - –û—Ç–∫—Ä—ã—Ç—å `payment_url` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   - (–í —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ —ç–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É)

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã**
   - GET `/api/subscriptions/status`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `is_trial = false`, –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∞

---

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ë–î
alembic current

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade <revision_id>

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
# (–ª–æ–≥–∏ –±—É–¥—É—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ uvicorn)
```

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –º–æ–¥–µ–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ `app/migration/env.py`

### –ü—Ä–æ–±–ª–µ–º–∞: –í–µ–±—Ö—É–∫–∏ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç
**–†–µ—à–µ–Ω–∏–µ:** 
- –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `BASE_URL` –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JWT-—Ç–æ–∫–µ–Ω –≤ `.env`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ –¢–æ—á–∫–µ
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –¢—Ä–∏–∞–ª –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `subscriptions` —Å–æ–∑–¥–∞–Ω–∞

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `app/subscriptions/README.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `SUBSCRIPTION_SETUP_GUIDE.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

**–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:**
- –¢–æ—á–∫–∞ API: https://developers.tochka.com/docs/tochka-api/
- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¢–æ—á–∫–∏: https://enter.tochka.com/

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–æ–ª—É—á–∏—Ç–µ JWT-—Ç–æ–∫–µ–Ω –æ—Ç –¢–æ—á–∫–∏**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ –¢–æ—á–∫–µ
   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥
   - –°–æ–∑–¥–∞–π—Ç–µ JWT-—Ç–æ–∫–µ–Ω

2. **–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env`**
   ```env
   TOCHKA_ACCESS_TOKEN=–≤–∞—à_—Ä–µ–∞–ª—å–Ω—ã–π_—Ç–æ–∫–µ–Ω
   ```

3. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
   ```bash
   alembic upgrade head
   ```

4. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã**
   ```bash
   python create_subscription_plans.py
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ**
   ```bash
   uvicorn app.main:app --reload
   ```

6. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ**
   - –≠–∫—Ä–∞–Ω —Ç–∞—Ä–∏—Ñ–æ–≤
   - –ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
   - Deep Links
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI

---

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–í—Å—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–£—Å–ø–µ—Ö–æ–≤! üöÄ
